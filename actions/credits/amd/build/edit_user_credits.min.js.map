{"version":3,"file":"edit_user_credits.min.js","sources":["../src/edit_user_credits.js"],"sourcesContent":["/**\n * Edit user credits.\n *\n * @module     pulseaction_credits/edit_user_credits\n * @copyright  2024\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'core_form/modalform', 'core/local/inplace_editable/events'],\n    function ($, Notification, ModalForm, InplaceEditableEvents) {\n\n        /**\n         * Initialize edit user credits functionality.\n         * @param {string} title Modal title\n         */\n        var init = function (title) {\n\n            document.addEventListener('click', function (e) {\n\n                if (!e.target.closest('[data-action=\"edit-user-credits\"]')) {\n                    return true;\n                }\n\n                e.preventDefault();\n\n                var button = e.target.closest('[data-action=\"edit-user-credits\"]');\n                var userid = button.dataset.userid;\n                var courseid = button.dataset.courseid;\n\n                if (!courseid) {\n                    Notification.addNotification({\n                        message: 'Course ID not found',\n                        type: 'error'\n                    });\n                    return;\n                }\n\n                showUserOverrideModal(userid, courseid, title);\n            });\n\n            // Update the notifications after inplace editable element is updated.\n            document.addEventListener(InplaceEditableEvents.eventTypes.elementUpdated, e => {\n                const inplaceEditable = e.target;\n                if (inplaceEditable.getAttribute('data-component') == 'pulseaction_credits') {\n                    Notification.fetchNotifications();\n                }\n            });\n        };\n\n        /**\n         * Show the edit credits modal with dynamic form.\n         *\n         * @param {number} userid User ID\n         * @param {number} courseid Course ID\n         * @param {string} title Modal title\n         */\n        var showUserOverrideModal = function (userid, courseid, title) {\n\n            const modalForm = new ModalForm({\n                formClass: 'pulseaction_credits\\\\form\\\\edit_user_credits',\n                args: { userid: userid, courseid: courseid },\n                modalConfig: {\n                    title: title,\n                    large: true\n                },\n                returnFocus: null\n            });\n\n            // Listen to form events.\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, function (e) {\n                const response = e.detail;\n\n                if (response.result) {\n                    Notification.addNotification({\n                        message: response.message,\n                        type: 'success'\n                    });\n                    // Reload the page to show updated data.\n                    window.location.reload();\n                } else {\n                    Notification.addNotification({\n                        message: response.message,\n                        type: 'error'\n                    });\n                }\n            });\n            modalForm.show();\n        };\n\n        return {\n            init: init\n        };\n\n    });\n"],"names":["define","$","Notification","ModalForm","InplaceEditableEvents","showUserOverrideModal","userid","courseid","title","modalForm","formClass","args","modalConfig","large","returnFocus","addEventListener","events","FORM_SUBMITTED","e","response","detail","result","addNotification","message","type","window","location","reload","show","init","document","target","closest","preventDefault","button","dataset","eventTypes","elementUpdated","getAttribute","fetchNotifications"],"mappings":";;;;;;;AAQAA,+CAAO,CAAC,SAAU,oBAAqB,sBAAuB,uCAC1D,SAAUC,EAAGC,aAAcC,UAAWC,2BA+C9BC,sBAAwB,SAAUC,OAAQC,SAAUC,aAE9CC,UAAY,IAAIN,UAAU,CAC5BO,UAAW,+CACXC,KAAM,CAAEL,OAAQA,OAAQC,SAAUA,UAClCK,YAAa,CACTJ,MAAOA,MACPK,OAAO,GAEXC,YAAa,OAIjBL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,SAAUC,SAC5DC,SAAWD,EAAEE,OAEfD,SAASE,QACTnB,aAAaoB,gBAAgB,CACzBC,QAASJ,SAASI,QAClBC,KAAM,YAGVC,OAAOC,SAASC,UAEhBzB,aAAaoB,gBAAgB,CACzBC,QAASJ,SAASI,QAClBC,KAAM,aAIlBf,UAAUmB,cAGP,CACHC,KA3EO,SAAUrB,OAEjBsB,SAASf,iBAAiB,SAAS,SAAUG,OAEpCA,EAAEa,OAAOC,QAAQ,4CACX,EAGXd,EAAEe,qBAEEC,OAAShB,EAAEa,OAAOC,QAAQ,qCAC1B1B,OAAS4B,OAAOC,QAAQ7B,OACxBC,SAAW2B,OAAOC,QAAQ5B,SAEzBA,SAQLF,sBAAsBC,OAAQC,SAAUC,OAPpCN,aAAaoB,gBAAgB,CACzBC,QAAS,sBACTC,KAAM,aASlBM,SAASf,iBAAiBX,sBAAsBgC,WAAWC,gBAAgBnB,IAEjB,uBAD9BA,EAAEa,OACNO,aAAa,mBAC7BpC,aAAaqC"}